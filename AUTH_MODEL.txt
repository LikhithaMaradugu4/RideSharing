AUTH MODEL (LOCKED)

We use PHONE + OTP based authentication for users.
OTP flow handles BOTH registration and login.
There is NO separate registration API.


OTP Send Logic:

- User enters phone number
- Backend ALWAYS sends OTP
- No pre-check for existing user is required


OTP Verify Logic:

1. Verify OTP from Redis
2. Fetch app_user by phone number

IF user EXISTS:
   - Treat as login
   - Issue JWT

IF user DOES NOT EXIST:
   - Create app_user with minimal fields
   - Issue JWT


On first OTP verification, create app_user with:

- phone (E.164 format)
- country_code (derived from phone)
- status = ACTIVE
- role = USER (neutral role)
- created_on


OTP login = identity creation OR authentication

- First OTP → registration
- Subsequent OTP → login


Profile APIs (/api/v2/profile):

- Used to enrich app_user
- Update:
   - full_name
   - gender
   - city_id
- Must NOT create users
- Must assume app_user already exists



Driver apply and Fleet owner apply:

- Require authenticated user
- Assume app_user already exists
- Create ONLY application records:
   - driver_profile (PENDING)
   - fleet application (PENDING)
- Do NOT create fleet at apply time



Tenant Admin Approval:

Driver approval:
- Approve driver_profile
- Set allowed_vehicle_categories
- Create INDIVIDUAL fleet (APPROVED)

Fleet owner approval (BUSINESS):
- Approve fleet
- fleet_type = BUSINESS


Admins:
- Created by platform admin
- Login via email + password
- Session-based auth
- No OTP
- No JWT
